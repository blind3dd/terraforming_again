# YubiKey AWS Assume Role Bash Completion
# This file provides bash completion for the yubikey-assume-role script

_yubikey_assume_role_completion() {
    local cur prev opts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    
    # Main commands
    local commands="assume interactive list identity clear-cache config help"
    
    # Options
    local options="-c --config -d --duration -n --no-cache -v --verbose --no-yubikey -h --help"
    
    # Role names from configuration
    local roles="{% for role_name in role_mappings.keys() %}{{ role_name }} {% endfor %}"
    
    case "${prev}" in
        assume)
            COMPREPLY=( $(compgen -W "${roles}" -- ${cur}) )
            return 0
            ;;
        -c|--config)
            COMPREPLY=( $(compgen -f -- ${cur}) )
            return 0
            ;;
        -d|--duration)
            COMPREPLY=( $(compgen -W "900 1800 3600 7200 14400 28800 43200" -- ${cur}) )
            return 0
            ;;
        yubikey-assume-role|yk-aws)
            COMPREPLY=( $(compgen -W "${commands} ${options}" -- ${cur}) )
            return 0
            ;;
    esac
    
    # If current word starts with a dash, show options
    if [[ ${cur} == -* ]]; then
        COMPREPLY=( $(compgen -W "${options}" -- ${cur}) )
        return 0
    fi
    
    # Otherwise show commands
    COMPREPLY=( $(compgen -W "${commands}" -- ${cur}) )
}

# Register the completion function
complete -F _yubikey_assume_role_completion yubikey-assume-role
complete -F _yubikey_assume_role_completion yk-aws

# Additional completion for common AWS commands
_yubikey_aws_completion() {
    local cur prev opts
    COMPREPLY=()
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"
    
    case "${prev}" in
        aws)
            COMPREPLY=( $(compgen -W "sts s3 ec2 iam" -- ${cur}) )
            return 0
            ;;
        sts)
            COMPREPLY=( $(compgen -W "assume-role get-caller-identity" -- ${cur}) )
            return 0
            ;;
    esac
}

complete -F _yubikey_aws_completion aws

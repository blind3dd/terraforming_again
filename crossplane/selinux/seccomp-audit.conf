# Audit Rules for Seccomp Security Events
# This file defines what seccomp-related events to audit

# Configure audit log file locations
-w /var/log/audit.log -p wa -k audit_log
-w /var/log/secure -p wa -k secure_log

# ===== SECCOMP SECURITY AUDIT =====

# Seccomp system call filtering
-a always,exit -F arch=b64 -S seccomp -F key=seccomp_filter
-a always,exit -F arch=b32 -S seccomp -F key=seccomp_filter

# Seccomp profile loading and configuration
-a always,exit -F arch=b64 -S openat -F path=/etc/seccomp* -F key=seccomp_config
-a always,exit -F arch=b32 -S openat -F path=/etc/seccomp* -F key=seccomp_config
-a always,exit -F arch=b64 -S openat -F path=/usr/share/seccomp* -F key=seccomp_config
-a always,exit -F arch=b32 -S openat -F path=/usr/share/seccomp* -F key=seccomp_config

# Seccomp profile file modifications
-w /etc/seccomp/ -p wa -k seccomp_config
-w /usr/share/seccomp/ -p wa -k seccomp_config
-w /var/lib/seccomp/ -p wa -k seccomp_config

# Seccomp-related system calls that should be monitored
-a always,exit -F arch=b64 -S prctl -F key=seccomp_prctl
-a always,exit -F arch=b32 -S prctl -F key=seccomp_prctl

# Seccomp violations and blocked system calls
-a always,exit -F arch=b64 -S seccomp -F success=0 -F key=seccomp_violation
-a always,exit -F arch=b32 -S seccomp -F success=0 -F key=seccomp_violation

# Process seccomp status changes
-a always,exit -F arch=b64 -S prctl -F a0=0x16 -F key=seccomp_status  # PR_GET_SECCOMP
-a always,exit -F arch=b64 -S prctl -F a0=0x17 -F key=seccomp_status  # PR_SET_SECCOMP
-a always,exit -F arch=b32 -S prctl -F a0=0x16 -F key=seccomp_status  # PR_GET_SECCOMP
-a always,exit -F arch=b32 -S prctl -F a0=0x17 -F key=seccomp_status  # PR_SET_SECCOMP

# Seccomp filter installation
-a always,exit -F arch=b64 -S seccomp -F a0=0x1 -F key=seccomp_install  # SECCOMP_SET_MODE_FILTER
-a always,exit -F arch=b32 -S seccomp -F a0=0x1 -F key=seccomp_install  # SECCOMP_SET_MODE_FILTER

# Seccomp mode changes
-a always,exit -F arch=b64 -S seccomp -F a0=0x0 -F key=seccomp_mode  # SECCOMP_SET_MODE_STRICT
-a always,exit -F arch=b64 -S seccomp -F a0=0x1 -F key=seccomp_mode  # SECCOMP_SET_MODE_FILTER
-a always,exit -F arch=b32 -S seccomp -F a0=0x0 -F key=seccomp_mode  # SECCOMP_SET_MODE_STRICT
-a always,exit -F arch=b32 -S seccomp -F a0=0x1 -F key=seccomp_mode  # SECCOMP_SET_MODE_FILTER

# Seccomp-related file access
-a always,exit -F arch=b64 -S openat -F path=/proc/*/status -F key=seccomp_proc_status
-a always,exit -F arch=b32 -S openat -F path=/proc/*/status -F key=seccomp_proc_status
-a always,exit -F arch=b64 -S openat -F path=/proc/*/seccomp -F key=seccomp_proc_seccomp
-a always,exit -F arch=b32 -S openat -F path=/proc/*/seccomp -F key=seccomp_proc_seccomp

# Seccomp configuration directory monitoring
-w /etc/seccomp/ -p wa -k seccomp_config
-w /usr/share/seccomp/ -p wa -k seccomp_config
-w /var/lib/seccomp/ -p wa -k seccomp_config

# Seccomp profile validation
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/seccomp-tools -F key=seccomp_tools
-a always,exit -F arch=b64 -S execve -F path=/usr/sbin/seccomp-tools -F key=seccomp_tools

# Seccomp-related kernel module operations
-a always,exit -F arch=b64 -S execve -F path=/sbin/modprobe -F key=seccomp_modules
-a always,exit -F arch=b64 -S execve -F path=/sbin/insmod -F key=seccomp_modules
-a always,exit -F arch=b64 -S execve -F path=/sbin/rmmod -F key=seccomp_modules

# Seccomp policy enforcement
-a always,exit -F arch=b64 -S seccomp -F success=1 -F key=seccomp_enforcement
-a always,exit -F arch=b32 -S seccomp -F success=1 -F key=seccomp_enforcement

# Seccomp filter compilation
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/bpfc -F key=seccomp_bpfc
-a always,exit -F arch=b64 -S execve -F path=/usr/sbin/bpfc -F key=seccomp_bpfc

# Seccomp profile testing
-a always,exit -F arch=b64 -S execve -F path=/usr/bin/seccomp-tools -F key=seccomp_testing
-a always,exit -F arch=b64 -S execve -F path=/usr/sbin/seccomp-tools -F key=seccomp_testing

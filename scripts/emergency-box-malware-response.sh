#!/bin/bash

echo "üö® EMERGENCY: BOX MALWARE DETECTED - UNKILLABLE PROCESSES"
echo "========================================================"
echo
echo "CRITICAL FINDINGS:"
echo "‚Ä¢ Box running without user login (PID 48484)"
echo "‚Ä¢ Process cannot be killed (kill -9 failed)"
echo "‚Ä¢ Spawning new processes automatically"
echo "‚Ä¢ This is MALWARE, not legitimate Box software"
echo
echo "IMMEDIATE ACTIONS:"
echo "1. DO NOT REBOOT - will lose evidence"
echo "2. Disconnect from network immediately"
echo "3. Document all processes before cleanup"
echo "4. Remove Box application completely"
echo "5. Check for persistence mechanisms"
echo

# Document current state
echo "üìã DOCUMENTING CURRENT STATE..."
echo "Box processes:"
ps aux | grep -i box | grep -v grep
echo
echo "Network connections:"
netstat -an | grep ESTABLISHED | head -10
echo

# Try to remove Box application
echo "üóëÔ∏è  ATTEMPTING TO REMOVE BOX APPLICATION..."
if [ -d "/Applications/Box.app" ]; then
    echo "Found Box.app - attempting removal..."
    sudo rm -rf "/Applications/Box.app"
    if [ $? -eq 0 ]; then
        echo "‚úÖ Box.app removed successfully"
    else
        echo "‚ùå Failed to remove Box.app - may need manual intervention"
    fi
else
    echo "Box.app not found in /Applications"
fi

# Check for Box in other locations
echo "üîç CHECKING FOR BOX IN OTHER LOCATIONS..."
find /Users -name "*box*" -type d 2>/dev/null | head -5
find /Library -name "*box*" -type d 2>/dev/null | head -5

# Check launch agents/daemons
echo "üîç CHECKING LAUNCH AGENTS/DAEMONS..."
ls -la ~/Library/LaunchAgents/ | grep -i box
ls -la /Library/LaunchAgents/ | grep -i box
ls -la /Library/LaunchDaemons/ | grep -i box

echo
echo "‚ö†Ô∏è  NEXT STEPS:"
echo "1. Disconnect from network NOW"
echo "2. Do NOT reboot yet"
echo "3. Run this script to clean up"
echo "4. Check for other malware"
echo "5. Only reboot after complete cleanup"

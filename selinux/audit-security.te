# SELinux Policy for Comprehensive Audit Logging
# This policy ensures all security events are properly logged

module audit_security 1.0.0;

require {
    type auditd_t;
    type auditd_exec_t;
    type auditd_config_t;
    type auditd_log_t;
    class file { read write create getattr append };
    class capability { audit_write audit_control net_admin };
    class process signal;
    class unix_stream_socket create;
}

# Audit types
type audit_security_t;
type audit_log_t;
type audit_config_t;

# Audit domains
type audit_daemon_t;
type audit_reader_t;

# File contexts
type audit_security_log_t;
type audit_security_config_t;

# Allow audit daemon to write logs
allow audit_daemon_t audit_security_log_t:file { write append create getattr };
allow audit_daemon_t audit_security_config_t:file { read getattr };

# Allow audit reader to read logs
allow audit_reader_t audit_security_log_t:file { read getattr };
allow audit_reader_t audit_security_config_t:file { read getattr };

# Allow audit system calls
allow audit_daemon_t self:capability { audit_write audit_control };

# Deny network access for audit
neverallow audit_daemon_t self:capability net_admin;
neverallow audit_reader_t self:capability net_admin;

# Allow audit to access system resources
allow audit_daemon_t self:process signal;
allow audit_daemon_t self:unix_stream_socket create;